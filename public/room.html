<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>RPS ROOM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      margin: 0;
      height: 100vh;
      background: radial-gradient(circle at top, #1b2a6b, #050b2c);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .card {
      width: 340px;
      background: rgba(10, 20, 70, 0.9);
      border-radius: 20px;
      padding: 28px;
      text-align: center;
      box-shadow: 0 0 30px rgba(0, 120, 255, 0.35);
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    h1 {
      margin: 0;
      font-size: 22px;
      letter-spacing: 1px;
    }

    .room-id {
      margin-top: 6px;
      opacity: 0.8;
      font-size: 14px;
    }

    .status {
      margin: 14px 0;
      min-height: 42px;
      font-size: 15px;
      color: #cfe2ff;
    }

    .choices {
      display: flex;
      justify-content: space-between;
      margin: 16px 0;
    }

    .choice-btn {
      width: 85px;
      height: 85px;
      font-size: 34px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      background: #0d6efd;
      color: white;
      transition: 0.2s;
    }

    .choice-btn:hover {
      transform: scale(1.08);
      background: #0b5ed7;
    }

    .choice-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .result {
      margin-top: 12px;
      font-size: 17px;
      font-weight: bold;
    }

    .win { color: #00ff9c; }
    .lose { color: #ff4d6d; }
    .draw { color: #ffd166; }

    .footer {
      margin-top: 16px;
      font-size: 12px;
      opacity: 0.7;
    }

    .copy-btn {
      margin-top: 10px;
      background: #222;
      border: none;
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="card">
  <h1>‚úä‚úã‚úåÔ∏è RPS ROOM</h1>
  <div class="room-id" id="roomIdText">ROOM</div>

  <div class="status" id="status">
    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
  </div>

  <div class="choices">
    <button class="choice-btn" onclick="play('rock')">üëä</button>
    <button class="choice-btn" onclick="play('paper')">‚úã</button>
    <button class="choice-btn" onclick="play('scissors')">‚úåÔ∏è</button>
  </div>

  <div class="result" id="result"></div>

  <button class="copy-btn" onclick="copyLink()">üîó ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡πâ‡∏≠‡∏á</button>

  <div class="footer">
    Real-time ‚Ä¢ Socket.IO
  </div>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const roomId = params.get("room") || "???";
  document.getElementById("roomIdText").innerText = "ROOM #" + roomId;

  const socket = io("https://nongtaeplayingsup.onrender.com");

  socket.emit("join-room", roomId);

  const statusEl = document.getElementById("status");
  const resultEl = document.getElementById("result");
  const buttons = document.querySelectorAll(".choice-btn");

  function disableButtons(state) {
    buttons.forEach(b => b.disabled = state);
  }

  function play(choice) {
    disableButtons(true);
    resultEl.innerHTML = "";
    statusEl.innerText = "‚è≥ ‡∏£‡∏≠‡∏≠‡∏µ‡∏Å‡∏ù‡πà‡∏≤‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...";
    socket.emit("play", { roomId, choice });
  }

  socket.on("result", (data) => {
    let cls = "draw";
    if (data.result.includes("‡∏ä‡∏ô‡∏∞")) cls = "win";
    if (data.result.includes("‡πÅ‡∏û‡πâ")) cls = "lose";

    resultEl.innerHTML = `
      üëä ${data.p1} vs ${data.p2}<br>
      <span class="${cls}">${data.result}</span>
    `;
    statusEl.innerText = "üéØ ‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢";
    disableButtons(false);
  });

  function copyLink() {
    navigator.clipboard.writeText(window.location.href);
    statusEl.innerText = "‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß";
  }
</script>

</body>
</html>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const url = new URLSearchParams(location.search);
const room = url.get("room");
const name = prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô");

socket.emit("join", { room, name });

function play(choice){
  document.getElementById("status").innerText = "‚è≥ ‡∏£‡∏≠‡∏≠‡∏µ‡∏Å‡∏ù‡∏±‡πà‡∏á...";
  socket.emit("play", choice);
}

socket.on("result", d => {
  const me = d.p1.name === name ? d.p1 : d.p2;
  const enemy = d.p1.name === name ? d.p2 : d.p1;

  let text = `‡∏Ñ‡∏∏‡∏ì: ${me.choice}\n`;
  text += `‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á: ${enemy.choice}\n`;

  if (d.result === "draw") text += "‡πÄ‡∏™‡∏°‡∏≠";
  else if (
    (d.result === "p1" && d.p1.name === name) ||
    (d.result === "p2" && d.p2.name === name)
  ) text += "üéâ ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞";
  else text += "üíÄ ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ";

  document.getElementById("status").innerText = text;
});
</script>
